plugins {
  id 'war'
}

configurations {
	postgres
}

dependencies {
  providedCompile 'javax:javaee-api:8.0.1'
  providedCompile 'org.eclipse.microprofile:microprofile:2.1'
    testImplementation 'org.testcontainers:postgresql:1.15.0'
    testImplementation group: 'org.slf4j', name: 'slf4j-log4j12', version: '1.7.36'
    testImplementation project(':microshed-testing-testcontainers')
    testImplementation project(':microshed-testing-core')
    testImplementation 'org.testcontainers:junit-jupiter:1.19.1'
  testImplementation 'org.junit.jupiter:junit-jupiter:5.10.1'
  postgres 'org.postgresql:postgresql:42.2.27'
}

task copyDriver(type: Copy) {
	from configurations.postgres
	include '**/*.jar'
	into 'src/main/liberty/config/resources'
	rename 'postgresql.*jar', 'postgresql.jar'
}

war.archiveFileName.set 'myservice.war'
test.dependsOn 'war'
test.dependsOn 'copyDriver'

// Always re-run tests on every build for the sake of this sample
// In a real project, this setting would not be desirable
test.outputs.upToDateWhen { false } 
